<section class="hero explore-hero">
  <app-breadcrumb
    [items]="[
      { label: 'Home', url: '/' },
      { label: 'Explore', url: '' }
    ]"
  ></app-breadcrumb>

  <div class="hero-wrapper">
    <div class="hero-content">
      <strong class="hero-explore">Discover Innovation</strong>
      <h1 class="hero-subtitle">Explore Bitcoin Projects</h1>
      <p class="hero-description">
        Find exciting projects building on Bitcoin technology and join the future of decentralized finance.
      </p>
      
      <div *ngIf="networkService.isMain(); else testnetBadge" class="network-badge">
        <span class="material-icons">warning</span>
        <span>Bitcoin Mainnet - Not yet released</span>
      </div>
      <ng-template #testnetBadge>
        <div class="network-badge testnet">
          <span class="material-icons">science</span>
          <span>Bitcoin Testnet</span>
        </div>
      </ng-template>
    </div>

    <!-- Filter and sorting controls -->
    <div class="explore-controls">
      <div class="search-container">
        <span class="material-icons search-icon">search</span>
        <input type="text" placeholder="Search projects..." class="search-input">
      </div>
      
      <div class="sort-filter">
        <button class="filter-button">
          <span class="material-icons">filter_list</span>
          <span class="filter-text">Filter</span>
        </button>
        
        <button class="sort-button">
          <span class="material-icons">sort</span>
          <span class="sort-text">Sort</span>
        </button>
      </div>
    </div>
  </div>
</section>

<div class="container">
  <div *ngIf="indexer.loading() && !indexer.projects().length; else content">
    <div class="loading-spinner">
      <div class="spinner"></div>
    </div>
  </div>
  <ng-template #content>
    <div *ngIf="indexer.projects().length === 0; else projects">
      <div class="empty-state">
        <div class="empty-icon">
          <span class="material-icons">explore_off</span>
        </div>
        <h2>No Projects Found</h2>
        <p>We couldn't find any projects at the moment. Try again later or check your connection.</p>
        <button class="primary-button" (click)="retryLoadProjects()">
          <span class="material-icons">refresh</span>
          Retry
        </button>
      </div>
    </div>
    <ng-template #projects>
      <section class="projects">
        <a *ngFor="let project of indexer.projects(); trackBy: trackByProjectIdentifier; let i = index" [routerLink]="['/project', project.projectIdentifier]" class="project-card" [attr.data-index]="i">
          <div
            class="project-banner"
            [style.background-image]="
              project.metadata?.['banner'] ?? ''
                ? 'url(' + (project.metadata?.['banner'] ?? '') + ')'
                : 'none'
            "
          >
            <!-- Add status icon overlaying the banner -->
            <ng-container *ngIf="isProjectEnded(project.details?.startDate)">
              <span *ngIf="isProjectSuccessfullyFunded(project)" class="material-icons status-icon status-funded">check_circle</span>
              <span *ngIf="!isProjectSuccessfullyFunded(project)" class="material-icons status-icon status-failed">cancel</span>
            </ng-container>
            
            <!-- Add favorite badge -->
            <span *ngIf="isFavorite(project.projectIdentifier)" class="favorite-badge">
              <span class="material-icons">bookmark</span>
            </span>
          </div>

          <div class="project-content">
            <ng-container *ngIf="project.details">
              <div
                class="project-avatar"
                [style.background-image]="
                  project.metadata?.['picture'] ?? ''
                    ? 'url(' + (project.metadata?.['picture'] ?? '') + ')'
                    : 'none'
                "
              ></div>

              <div class="project-header">
                <h3 class="project-title">
                  <ng-container *ngIf="(project.metadata?.['name'] ?? '') !== ''">
                    {{ project.metadata?.['name'] }}
                  </ng-container>
                  <ng-container *ngIf="(project.metadata?.['name'] ?? '') === ''">
                    {{ project.projectIdentifier | slice:0:12 }}...
                  </ng-container>
                </h3>
                
                <div class="project-date">
                  <span class="material-icons date-icon">event</span>
                  <span>{{ isProjectNotStarted(project.details.startDate) ? 'Ends' : 'Ended' }} {{ project.details.startDate | ago }}</span>
                </div>
              </div>
              
              <p class="project-description" *ngIf="(project.metadata?.['about'] ?? '') !== ''">
                {{ (project.metadata?.['about'] ?? '') | slice:0:100 }}{{ ((project.metadata?.['about'] ?? '').length > 100) ? '...' : '' }}
              </p>
              <p class="project-description placeholder" *ngIf="(project.metadata?.['about'] ?? '') === ''">No description available</p>

              <div class="funding-progress">
                <div class="progress-info">
                  <div class="investor-count">
                    <span class="material-icons">people</span>
                    <span class="count">{{ project.stats?.investorCount ?? 0 }}</span>
                    <span class="label">Investors</span>
                  </div>
                  
                  <div class="amount-raised">
                    <span class="btc-amount">{{ bitcoin.toBTC(project.stats?.amountInvested ?? 0) }}</span>
                    <span class="symbol">{{ networkService.isMain() ? 'BTC' : 'TBTC' }}</span>
                    <span class="divider">/</span>
                    <span class="target">{{ bitcoin.toBTC(project.details.targetAmount) }}</span>
                  </div>
                </div>
                
                <div class="progress-bar">
                  <div class="progress-fill" [style.width]="getFundingPercentage(project) + '%'">
                    <span class="percentage" *ngIf="getFundingPercentage(project) > 15">
                      {{ getFundingPercentage(project) }}%
                    </span>
                  </div>
                  <span class="percentage-outside" *ngIf="getFundingPercentage(project) <= 15">
                    {{ getFundingPercentage(project) }}%
                  </span>
                </div>
              </div>
              
              <div class="project-footer">
                <div class="tag" *ngIf="isProjectNotStarted(project.details.startDate)">
                  <span class="material-icons">hourglass_top</span>
                  <span>Upcoming</span>
                </div>
                <div class="tag active" *ngIf="!isProjectNotStarted(project.details.startDate) && !isProjectEnded(project.details.expiryDate)">
                  <span class="material-icons">timelapse</span>
                  <span>Active</span>
                </div>
                <div class="tag ended" *ngIf="isProjectEnded(project.details.expiryDate)">
                  <span class="material-icons">flag</span>
                  <span>Completed</span>
                </div>
                
                <button class="action-button">
                  <span class="material-icons">arrow_forward</span>
                </button>
              </div>
            </ng-container>
          </div>
        </a>
      </section>

      <div *ngIf="!indexer.isComplete(); else allLoaded">
        <div *ngIf="indexer.loading(); else loadMore">
          <div class="loading-spinner">
            <div class="spinner"></div>
          </div>
        </div>
        <ng-template #loadMore>
          <div class="load-more">
            <button class="primary-button" (click)="loadMoreProjects()">
              <span class="material-icons">expand_more</span>
              Load More Projects
            </button>
          </div>
        </ng-template>

        <!-- Move trigger after the button -->
        <div #scrollTrigger class="scroll-trigger"></div>
      </div>
      <ng-template #allLoaded>
        <div class="load-finished">
          <div class="checkmark-container">
            <span class="material-icons checkmark">done_all</span>
          </div>
          <h3 class="achievement-title">All Projects Loaded</h3>
          <p class="achievement-subtitle">You've viewed all available projects. Ready to find your next investment?</p>
        </div>
      </ng-template>
    </ng-template>
  </ng-template>
</div>