<section class="hero settings-hero">
    <app-breadcrumb
      [items]="[
        { label: 'Home', url: '/' },
        { label: 'Settings', url: '/settings' }
      ]"
    ></app-breadcrumb>

    <div class="hero-wrapper">
      <div class="hero-content">
        <h1>Settings</h1>
        <p class="hero-description">Customize your Angor Hub experience</p>
      </div>
    </div>
  </section>

  <div class="settings-container">
    <div class="settings-sidebar">
      <div 
        class="sidebar-item" 
        [class.active]="activeTab() === 'appearance'" 
        (click)="setActiveTab('appearance')"
      >
        <span class="material-icons">palette</span>
        <span>Appearance</span>
      </div>
      <div 
        class="sidebar-item" 
        [class.active]="activeTab() === 'network'" 
        (click)="setActiveTab('network')"
      >
        <span class="material-icons">public</span>
        <span>Network</span>
      </div>
      <div 
        class="sidebar-item" 
        [class.active]="activeTab() === 'relays'" 
        (click)="setActiveTab('relays')"
      >
        <span class="material-icons">settings_input_antenna</span>
        <span>Relays</span>
      </div>
      <div 
        class="sidebar-item" 
        [class.active]="activeTab() === 'indexers'" 
        (click)="setActiveTab('indexers')"
      >
        <span class="material-icons">storage</span>
        <span>Indexers</span>
      </div>
      <div 
        class="sidebar-item" 
        [class.active]="activeTab() === 'about'" 
        (click)="setActiveTab('about')"
      >
        <span class="material-icons">info</span>
        <span>About</span>
      </div>
    </div>
    
    <div class="settings-content" [@fadeInOut]>
      <!-- Appearance Tab -->
      @if (activeTab() === 'appearance') {
        <div class="settings-card">
          <h2>
            <span class="material-icons">palette</span>
            Appearance
          </h2>
          
          <div class="setting-group">
            <label class="setting-label">Theme</label>
            <p class="setting-description">Choose your preferred theme mode</p>
            
            <div class="theme-options">
              <button 
                class="theme-option" 
                [class.active]="currentTheme() === 'light'"
                (click)="setTheme('light')"
              >
                <div class="theme-preview light">
                  <span class="material-icons">light_mode</span>
                </div>
                <span class="theme-name">Light</span>
              </button>
              
              <button 
                class="theme-option" 
                [class.active]="currentTheme() === 'dark'"
                (click)="setTheme('dark')"
              >
                <div class="theme-preview dark">
                  <span class="material-icons">dark_mode</span>
                </div>
                <span class="theme-name">Dark</span>
              </button>
              
              <button 
                class="theme-option" 
                [class.active]="currentTheme() === 'system'"
                (click)="setTheme('system')"
              >
                <div class="theme-preview system">
                  <span class="material-icons">devices</span>
                </div>
                <span class="theme-name">System</span>
              </button>
            </div>
          </div>
        </div>
      }

      <!-- Network Tab -->
      @if (activeTab() === 'network') {
        <div class="settings-card">
          <h2>
            <span class="material-icons">public</span>
            Network
          </h2>
          
          <div class="setting-group">
            <label class="setting-label">Bitcoin Network</label>
            <p class="setting-description">Select which Bitcoin network to use</p>
            
            <div class="network-options">
              <button 
                class="network-option" 
                [class.active]="currentNetwork() === 'main'"
                (click)="setNetwork('main')"
                [attr.aria-pressed]="currentNetwork() === 'main'"
              >
                <div class="network-icon mainnet">
                  <span class="material-icons">currency_bitcoin</span>
                </div>
                <div class="network-info">
                  <span class="network-name">Mainnet</span>
                  <span class="network-desc">Live Bitcoin network with real value</span>
                </div>
                @if (currentNetwork() === 'main') {
                  <span class="material-icons check-icon">check_circle</span>
                }
              </button>
              
              <button 
                class="network-option" 
                [class.active]="currentNetwork() === 'test'"
                (click)="setNetwork('test')"
                [attr.aria-pressed]="currentNetwork() === 'test'"
              >
                <div class="network-icon testnet">
                  <span class="material-icons">science</span>
                </div>
                <div class="network-info">
                  <span class="network-name">Testnet</span>
                  <span class="network-desc">Testing network with no real value</span>
                </div>
                @if (currentNetwork() === 'test') {
                  <span class="material-icons check-icon">check_circle</span>
                }
              </button>
            </div>
          </div>
        </div>
      }

      <!-- Relays Tab -->
      @if (activeTab() === 'relays') {
        <div class="settings-card">
          <h2>
            <span class="material-icons">settings_input_antenna</span>
            Nostr Relays
          </h2>
          
          <div class="setting-group">
            <label class="setting-label">Manage Relays</label>
            <p class="setting-description">Configure which Nostr relays to connect to</p>
            
            <div class="relay-header">
              <span class="relay-count">{{ relayUrls().length }} relays connected</span>
              <button class="relay-reset-btn" (click)="resetToDefaultRelays()">
                <span class="material-icons">restart_alt</span>
                Reset to defaults
              </button>
            </div>
            
            <div class="relay-list">
              @if (relayUrls().length === 0) {
                <div class="empty-state">
                  <span class="material-icons">signal_wifi_off</span>
                  <p>No relays configured. Add a relay or reset to defaults.</p>
                </div>
              }
              
              @for (relay of relayUrls(); track relay) {
                <div class="relay-item" [@fadeInOut]>
                  <div class="relay-details">
                    <span class="material-icons relay-icon">wifi</span>
                    <span class="relay-url">{{ relay }}</span>
                  </div>
                  <button class="relay-remove" (click)="removeRelay(relay)" title="Remove relay">
                    <span class="material-icons">close</span>
                  </button>
                </div>
              }
            </div>
            
            <div class="relay-add-container">
              <div class="input-group">
                <div class="relay-input-wrapper">
                  <span class="material-icons input-icon">add_link</span>
                  <input 
                    type="text" 
                    [(ngModel)]="newRelayUrl" 
                    placeholder="wss://relay.example.com"
                    class="relay-input"
                    [class.invalid]="newRelayUrl() && !isValidUrl(newRelayUrl())"
                    (keyup.enter)="addRelay()"
                  />
                </div>
                <button 
                  class="relay-add-btn" 
                  [disabled]="!newRelayUrl() || !isValidUrl(newRelayUrl())"
                  (click)="addRelay()"
                >
                  <span class="material-icons">add_circle</span>
                  <span>Add</span>
                </button>
              </div>
            </div>
            
            @if (newRelayUrl() && !isValidUrl(newRelayUrl())) {
              <div class="error-message" [@fadeInOut]>
                <span class="material-icons">error</span>
                Must be a valid WebSocket URL (wss://)
              </div>
            }
            
            <div class="relay-save-container">
              <button 
                class="relay-save-btn" 
                [disabled]="relayUrls().length === 0"
                (click)="saveAndReloadRelays()"
              >
                <span class="material-icons">save</span>
                Save & Reload Relays
              </button>
              
              @if (relaySaveMessage()) {
                <div class="save-message" [@fadeInOut]>
                  {{ relaySaveMessage() }}
                </div>
              }
            </div>
          </div>
        </div>
      }

      <!-- Indexers Tab -->
      @if (activeTab() === 'indexers') {
        <div class="settings-card">
          <h2>
            <span class="material-icons">storage</span>
            Indexers
          </h2>
          
          <div class="setting-group">
            <label class="setting-label">Manage Indexers</label>
            <p class="setting-description">Configure indexer endpoints for project data retrieval</p>
            
            <div class="indexers-header">
              <button class="indexers-reset-btn" (click)="resetToDefaultIndexers()">
                <span class="material-icons">restart_alt</span>
                Reset to defaults
              </button>
            </div>
            
            <!-- Mainnet Indexers -->
            <div class="indexers-network-section">
              <h3 class="indexers-network-title">
                <span class="material-icons mainnet-icon">currency_bitcoin</span>
                Mainnet Indexers
              </h3>
              
              <div class="indexers-list">
                @if (getMainnetIndexers().length === 0) {
                  <div class="empty-state">
                    <span class="material-icons">dns_disabled</span>
                    <p>No mainnet indexers configured. Add an indexer or reset to defaults.</p>
                  </div>
                }
                
                @for (indexer of getMainnetIndexers(); track indexer.url) {
                  <div class="indexer-item" [@fadeInOut]>
                    <div class="indexer-content">
                      <div class="indexer-details">
                        <div class="indexer-icon-container">
                          <span class="material-icons indexer-icon">dns</span>
                          @if (indexer.isPrimary) {
                            <span class="primary-badge" title="Primary Indexer">
                              <span class="material-icons">star</span>
                            </span>
                          }
                        </div>
                        <span class="indexer-url">{{ indexer.url }}</span>
                      </div>
                      <div class="indexer-actions">
                        @if (indexerTestingUrl() === indexer.url) {
                          <span class="indexer-testing">
                            <div class="loading-spinner"></div>
                            Testing...
                          </span>
                        } @else if (indexerTestingUrl() !== indexer.url && indexerTestResult() !== null) {
                        } @else {
                          <button 
                            class="indexer-action-btn indexer-test"
                            (click)="testIndexerConnection(indexer.url)" 
                            title="Test connection"
                          >
                            <span class="material-icons">network_check</span>
                          </button>
                        }
                        
                        @if (!indexer.isPrimary) {
                          <button 
                            class="indexer-action-btn indexer-primary" 
                            (click)="setPrimaryIndexer(indexer.url, true)" 
                            title="Make primary"
                          >
                            <span class="material-icons">star_outline</span>
                          </button>
                        }
                        
                        @if (getMainnetIndexers().length > 1) {
                          <button 
                            class="indexer-action-btn indexer-remove" 
                            (click)="removeIndexer(indexer.url, true)" 
                            title="Remove indexer"
                          >
                            <span class="material-icons">close</span>
                          </button>
                        }
                      </div>
                    </div>
                    
                    @if (indexerTestingUrl() === indexer.url && indexerTestResult() !== null) {
                      <div class="indexer-test-result" [@fadeInOut]>
                        @if (indexerTestResult()) {
                          <span class="test-success">
                            <span class="material-icons">check_circle</span>
                            Connection successful
                          </span>
                        } @else {
                          <span class="test-failed">
                            <span class="material-icons">error</span>
                            Connection failed
                          </span>
                        }
                      </div>
                    }
                  </div>
                }
              </div>
              
              <div class="indexer-add-container">
                <div class="input-group">
                  <div class="relay-input-wrapper">
                    <span class="material-icons input-icon">add_link</span>
                    <input 
                      type="text" 
                      [(ngModel)]="newMainnetIndexerUrl" 
                      placeholder="https://explorer.example.com/"
                      class="relay-input"
                      [class.invalid]="newMainnetIndexerUrl() && !isValidIndexerUrl(newMainnetIndexerUrl())"
                      (keyup.enter)="addIndexer(true)"
                    />
                  </div>
                  <button 
                    class="relay-add-btn" 
                    [disabled]="!newMainnetIndexerUrl() || !isValidIndexerUrl(newMainnetIndexerUrl())"
                    (click)="addIndexer(true)"
                  >
                    <span class="material-icons">add_circle</span>
                    <span>Add</span>
                  </button>
                </div>
              </div>
              
              @if (newMainnetIndexerUrl() && !isValidIndexerUrl(newMainnetIndexerUrl())) {
                <div class="error-message" [@fadeInOut]>
                  <span class="material-icons">error</span>
                  Must be a valid HTTP/HTTPS URL
                </div>
              }
            </div>
            
            <!-- Testnet Indexers -->
            <div class="indexers-network-section">
              <h3 class="indexers-network-title">
                <span class="material-icons testnet-icon">science</span>
                Testnet Indexers
              </h3>
              
              <div class="indexers-list">
                @if (getTestnetIndexers().length === 0) {
                  <div class="empty-state">
                    <span class="material-icons">dns_disabled</span>
                    <p>No testnet indexers configured. Add an indexer or reset to defaults.</p>
                  </div>
                }
                
                @for (indexer of getTestnetIndexers(); track indexer.url) {
                  <div class="indexer-item" [@fadeInOut]>
                    <div class="indexer-content">
                      <div class="indexer-details">
                        <div class="indexer-icon-container">
                          <span class="material-icons indexer-icon">dns</span>
                          @if (indexer.isPrimary) {
                            <span class="primary-badge" title="Primary Indexer">
                              <span class="material-icons">star</span>
                            </span>
                          }
                        </div>
                        <span class="indexer-url">{{ indexer.url }}</span>
                      </div>
                      <div class="indexer-actions">
                        @if (indexerTestingUrl() === indexer.url) {
                          <span class="indexer-testing">
                            <div class="loading-spinner"></div>
                            Testing...
                          </span>
                        } @else if (indexerTestingUrl() !== indexer.url && indexerTestResult() !== null) {
                        } @else {
                          <button 
                            class="indexer-action-btn indexer-test" 
                            (click)="testIndexerConnection(indexer.url)" 
                            title="Test connection"
                          >
                            <span class="material-icons">network_check</span>
                          </button>
                        }
                        
                        @if (!indexer.isPrimary) {
                          <button 
                            class="indexer-action-btn indexer-primary" 
                            (click)="setPrimaryIndexer(indexer.url, false)" 
                            title="Make primary"
                          >
                            <span class="material-icons">star_outline</span>
                          </button>
                        }
                        
                        @if (getTestnetIndexers().length > 1) {
                          <button 
                            class="indexer-action-btn indexer-remove" 
                            (click)="removeIndexer(indexer.url, false)" 
                            title="Remove indexer"
                          >
                            <span class="material-icons">close</span>
                          </button>
                        }
                      </div>
                    </div>
                    
                    @if (indexerTestingUrl() === indexer.url && indexerTestResult() !== null) {
                      <div class="indexer-test-result" [@fadeInOut]>
                        @if (indexerTestResult()) {
                          <span class="test-success">
                            <span class="material-icons">check_circle</span>
                            Connection successful
                          </span>
                        } @else {
                          <span class="test-failed">
                            <span class="material-icons">error</span>
                            Connection failed
                          </span>
                        }
                      </div>
                    }
                  </div>
                }
              </div>
              
              <div class="indexer-add-container">
                <div class="input-group">
                  <div class="relay-input-wrapper">
                    <span class="material-icons input-icon">add_link</span>
                    <input 
                      type="text" 
                      [(ngModel)]="newTestnetIndexerUrl" 
                      placeholder="https://tbtc.indexer.example.com/"
                      class="relay-input"
                      [class.invalid]="newTestnetIndexerUrl() && !isValidIndexerUrl(newTestnetIndexerUrl())"
                      (keyup.enter)="addIndexer(false)"
                    />
                  </div>
                  <button 
                    class="relay-add-btn" 
                    [disabled]="!newTestnetIndexerUrl() || !isValidIndexerUrl(newTestnetIndexerUrl())"
                    (click)="addIndexer(false)"
                  >
                    <span class="material-icons">add_circle</span>
                    <span>Add</span>
                  </button>
                </div>
              </div>
              
              @if (newTestnetIndexerUrl() && !isValidIndexerUrl(newTestnetIndexerUrl())) {
                <div class="error-message" [@fadeInOut]>
                  <span class="material-icons">error</span>
                  Must be a valid HTTP/HTTPS URL
                </div>
              }
            </div>
            
            <div class="indexer-save-container">
              <button 
                class="relay-save-btn" 
                (click)="saveAndApplyIndexers()"
              >
                <span class="material-icons">save</span>
                Save & Apply Changes
              </button>
              
              @if (indexerSaveMessage()) {
                <div class="save-message" [@fadeInOut]>
                  {{ indexerSaveMessage() }}
                </div>
              }
            </div>
          </div>
        </div>
      }
      
      <!-- About Tab -->
      @if (activeTab() === 'about') {
        <div class="settings-card">
          <h2>
            <span class="material-icons">info</span>
            About Angor Hub
          </h2>
          
          <div class="about-content">
            <div class="logo-container">
              <img src="/images/logo-text.svg" alt="Angor Logo" class="about-logo" />
            </div>
            
            <div class="version-info">
              <p class="version">Version {{ appVersion }}</p>
             </div>
            
            <div class="about-description">
              <p>Angor Hub is an explorer for Bitcoin fundraising projects built on the Angor protocol. It provides a way to discover and track Bitcoin funding opportunities.</p>
            </div>
            
            <div class="links-section">
              <h3>Resources</h3>
              <div class="resource-links">
                <a href="https://angor.io" target="_blank" rel="noopener" class="resource-link">
                  <span class="material-icons">home</span>
                  <span>Official Website</span>
                </a>
                <a href="https://docs.angor.io" target="_blank" rel="noopener" class="resource-link">
                  <span class="material-icons">description</span>
                  <span>Documentation</span>
                </a>
                <a href="https://github.com/block-core/angor" target="_blank" rel="noopener" class="resource-link">
                  <span class="material-icons">code</span>
                  <span>Source Code</span>
                </a>
                <a href="https://blog.angor.io" target="_blank" rel="noopener" class="resource-link">
                  <span class="material-icons">article</span>
                  <span>Blog</span>
                </a>
              </div>
            </div>
          </div>
        </div>
      }
    </div>
  </div>