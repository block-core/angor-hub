<section class="container mx-auto px-4 pt-8 pb-12 relative"> 
  <app-breadcrumb
    [items]="[
      { label: 'Home', url: '/' },
      { label: 'Settings', url: '' }
    ]"
    class="mb-4" 
  ></app-breadcrumb>

    <div class="hero relative text-center mb-8"> <!-- Removed padding from hero -->
      <div class="hero-wrapper">
        <div class="hero-content">
          <h1 class="text-3xl md:text-4xl font-bold mb-2">Settings</h1>
          <p class="text-lg text-text-secondary mb-0">Customize your Angor Hub experience</p>
        </div>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-[240px_1fr] gap-4 md:gap-8 max-w-7xl mx-auto"> <!-- Removed my-8, px-4/8 -->
    <div class="flex flex-row flex-wrap md:flex-col gap-2 h-fit rounded-xl bg-surface-card p-4 shadow-md">
      <div 
        class="flex items-center gap-4 p-3 md:p-4 rounded-lg cursor-pointer transition duration-200 ease-in-out text-text hover:bg-surface-hover hover:text-accent flex-1 md:flex-none justify-center md:justify-start" 
        [class.bg-accent]="activeTab() === 'appearance'" 
        [class.text-white]="activeTab() === 'appearance'" 
        (click)="setActiveTab('appearance')"
      >
        <span class="material-icons text-text-secondary transition duration-200 ease-in-out" [class.text-white]="activeTab() === 'appearance'">palette</span>
        <span class="hidden md:inline">Appearance</span>
      </div>
      <div 
        class="flex items-center gap-4 p-3 md:p-4 rounded-lg cursor-pointer transition duration-200 ease-in-out text-text hover:bg-surface-hover hover:text-accent flex-1 md:flex-none justify-center md:justify-start" 
        [class.bg-accent]="activeTab() === 'network'" 
        [class.text-white]="activeTab() === 'network'" 
        (click)="setActiveTab('network')"
      >
        <span class="material-icons text-text-secondary transition duration-200 ease-in-out" [class.text-white]="activeTab() === 'network'">public</span>
        <span class="hidden md:inline">Network</span>
      </div>
      <div 
        class="flex items-center gap-4 p-3 md:p-4 rounded-lg cursor-pointer transition duration-200 ease-in-out text-text hover:bg-surface-hover hover:text-accent flex-1 md:flex-none justify-center md:justify-start" 
        [class.bg-accent]="activeTab() === 'relays'" 
        [class.text-white]="activeTab() === 'relays'" 
        (click)="setActiveTab('relays')"
      >
        <span class="material-icons text-text-secondary transition duration-200 ease-in-out" [class.text-white]="activeTab() === 'relays'">settings_input_antenna</span>
        <span class="hidden md:inline">Relays</span>
      </div>
      <div 
        class="flex items-center gap-4 p-3 md:p-4 rounded-lg cursor-pointer transition duration-200 ease-in-out text-text hover:bg-surface-hover hover:text-accent flex-1 md:flex-none justify-center md:justify-start" 
        [class.bg-accent]="activeTab() === 'indexers'" 
        [class.text-white]="activeTab() === 'indexers'" 
        (click)="setActiveTab('indexers')"
      >
        <span class="material-icons text-text-secondary transition duration-200 ease-in-out" [class.text-white]="activeTab() === 'indexers'">storage</span>
        <span class="hidden md:inline">Indexers</span>
      </div>
      <div 
        class="flex items-center gap-4 p-3 md:p-4 rounded-lg cursor-pointer transition duration-200 ease-in-out text-text hover:bg-surface-hover hover:text-accent flex-1 md:flex-none justify-center md:justify-start" 
        [class.bg-accent]="activeTab() === 'about'" 
        [class.text-white]="activeTab() === 'about'" 
        (click)="setActiveTab('about')"
      >
        <span class="material-icons text-text-secondary transition duration-200 ease-in-out" [class.text-white]="activeTab() === 'about'">info</span>
        <span class="hidden md:inline">About</span>
      </div>
    </div>
    
    <div class="flex flex-col gap-6" [@fadeInOut]>
      <!-- Appearance Tab -->
      @if (activeTab() === 'appearance') {
        <div class="bg-surface-card rounded-xl p-4 sm:p-6 shadow-md"> <!-- Adjusted padding -->
          <h2 class="flex items-center gap-3 mt-0 mb-6 text-2xl font-semibold text-text">
            <span class="material-icons text-accent text-3xl">palette</span>
            Appearance
          </h2>
          
          <div class="py-5 border-b border-border last:border-b-0 last:pb-0">
            <label class="block text-lg font-semibold mb-2 text-text">Theme</label>
            <p class="text-text-secondary mb-5 text-sm leading-normal">Choose your preferred theme mode</p>
            
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4"> <!-- Adjusted grid for consistency -->
              <button 
                class="flex flex-col items-center gap-3 p-4 rounded-lg bg-surface-hover border-2 border-transparent cursor-pointer transition duration-200 ease-in-out hover:-translate-y-1 hover:shadow-lg" 
                [class.border-accent]="currentTheme() === 'light'"
                [class.bg-accent]="currentTheme() === 'light'"
                (click)="setTheme('light')"
              >
                <div class="w-14 h-14 rounded-full flex items-center justify-center transition duration-200 ease-in-out bg-white border border-border"> <!-- Adjusted size/style -->
                  <span class="material-icons text-3xl text-yellow-500">light_mode</span>
                </div>
                <span class="font-medium transition duration-200 ease-in-out text-text" [class.text-accent]="currentTheme() === 'light'" [class.font-semibold]="currentTheme() === 'light'">Light</span>
              </button>

              <button 
                class="flex flex-col items-center gap-3 p-4 rounded-lg bg-surface-hover border-2 border-transparent cursor-pointer transition duration-200 ease-in-out hover:border-accent/50 hover:-translate-y-1 hover:shadow-lg"
                [class.!border-accent]="currentTheme() === 'dark'"
                [class.ring-2]="currentTheme() === 'dark'"
                [class.ring-accent]="currentTheme() === 'dark'"
                (click)="setTheme('dark')"
                aria-label="Select Dark Theme"
              >
                <div class="w-14 h-14 rounded-full flex items-center justify-center transition duration-200 ease-in-out bg-gray-800 border border-gray-700 shadow-inner"> <!-- Adjusted dark theme icon bg -->
                    <span class="material-icons text-3xl text-blue-300">dark_mode</span>
                </div>
                <span class="font-medium transition duration-200 ease-in-out text-text" [class.text-accent]="currentTheme() === 'dark'" [class.font-semibold]="currentTheme() === 'dark'">Dark</span>
              </button>

              <button
                class="flex flex-col items-center gap-3 p-4 rounded-lg bg-surface-ground border-2 border-transparent cursor-pointer transition duration-200 ease-in-out hover:border-accent/50 hover:-translate-y-1 hover:shadow-lg"
                [class.!border-accent]="currentTheme() === 'system'"
                [class.ring-2]="currentTheme() === 'system'"
                [class.ring-accent]="currentTheme() === 'system'"
                (click)="setTheme('system')"
                aria-label="Select System Theme"
              >
                <div class="w-14 h-14 rounded-full flex items-center justify-center transition duration-200 ease-in-out bg-surface-hover border border-border shadow-inner"> <!-- Removed gradient, added bg-surface-hover -->
                  <span class="material-icons text-3xl text-text-secondary">desktop_windows</span>
                </div>
                <span class="font-medium transition duration-200 ease-in-out text-text" [class.text-accent]="currentTheme() === 'system'" [class.font-semibold]="currentTheme() === 'system'">System</span>
              </button>
              </div>
            </div>
          </div> <!-- Close bg-surface-card for appearance tab -->
        }
  
          <!-- Network Tab -->
          @if (activeTab() === 'network') {
          <div class="bg-surface-card rounded-xl p-5 sm:p-6 shadow-md">
            <h2 class="flex items-center gap-3 mt-0 mb-6 text-2xl font-semibold text-text">
              <span class="material-icons text-accent text-3xl">public</span>
              Network
            </h2>

            <div class="py-5 border-t border-border"> <!-- Added top border -->
              <label class="block text-lg font-semibold mb-2 text-text">Bitcoin Network</label>
              <p class="text-text-secondary mb-5 text-sm leading-normal">Select which Bitcoin network to use for data and interactions.</p>

              <div class="flex flex-col gap-4">
                <button
                  class="flex items-center gap-4 p-4 rounded-lg bg-surface-ground border-2 border-transparent cursor-pointer transition duration-200 ease-in-out text-left w-full hover:border-accent/50 hover:-translate-y-0.5 hover:shadow-md"
                  [class.!border-accent]="currentNetwork() === 'main'"
                  [class.ring-2]="currentNetwork() === 'main'"
                  [class.ring-accent]="currentNetwork() === 'main'"
                  (click)="setNetwork('main')"
                  [attr.aria-pressed]="currentNetwork() === 'main'"
                >
                  <div class="w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0 bg-orange-500/10 text-bitcoin-mainnet border border-orange-500/20"> <!-- Added border -->
                    <span class="material-icons text-3xl">currency_bitcoin</span>
                  </div>
                  <div class="flex-1">
                    <span class="block font-semibold mb-1 text-text">Mainnet</span>
                    <span class="text-sm text-text-secondary">Live Bitcoin network with real value transactions.</span>
                  </div>
                  @if (currentNetwork() === 'main') {
                    <span class="material-icons text-accent ml-auto text-2xl">check_circle</span>
                  }
                </button>

                <button
                  class="flex items-center gap-4 p-4 rounded-lg bg-surface-ground border-2 border-transparent cursor-pointer transition duration-200 ease-in-out text-left w-full hover:border-accent/50 hover:-translate-y-0.5 hover:shadow-md"
                  [class.!border-accent]="currentNetwork() === 'test'"
                  [class.ring-2]="currentNetwork() === 'test'"
                  [class.ring-accent]="currentNetwork() === 'test'"
                  (click)="setNetwork('test')"
                  [attr.aria-pressed]="currentNetwork() === 'test'"
                >
                  <div class="w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0 bg-green-500/10 text-bitcoin-testnet border border-green-500/20"> <!-- Added border -->
                    <span class="material-icons text-3xl">science</span>
                  </div>
                  <div class="flex-1">
                    <span class="block font-semibold mb-1 text-text">Testnet</span>
                    <span class="text-sm text-text-secondary">Testing network using valueless test Bitcoin.</span>
                  </div>
                  @if (currentNetwork() === 'test') {
                    <span class="material-icons text-accent ml-auto text-2xl">check_circle</span>
                  }
                </button>
              </div>
            </div>
          </div>
        }

        <!-- Relays Tab -->
        @if (activeTab() === 'relays') {
          <div class="bg-surface-card rounded-xl p-5 sm:p-6 shadow-md">
            <h2 class="flex items-center gap-3 mt-0 mb-6 text-2xl font-semibold text-text">
              <span class="material-icons text-accent text-3xl">settings_input_antenna</span>
              Nostr Relays
            </h2>

            <div class="py-5 border-t border-border"> <!-- Added top border -->
              <label class="block text-lg font-semibold mb-2 text-text">Manage Relays</label>
              <p class="text-text-secondary mb-5 text-sm leading-normal">Configure which Nostr relays to connect to for real-time updates and interactions.</p>

              <div class="flex items-center justify-between mb-4">
                <span class="text-text-secondary text-sm">{{ relayUrls().length }} relays configured</span>
                <button class="flex items-center gap-2 bg-none border-none text-sm text-accent cursor-pointer p-2 rounded transition duration-200 ease-in-out hover:bg-accent/10" (click)="resetToDefaultRelays()">
                  <span class="material-icons text-lg">restart_alt</span>
                  Reset to defaults
                </button>
              </div>

              <div class="max-h-72 overflow-y-auto mb-6 border border-border rounded-lg bg-surface-ground">
                @if (relayUrls().length === 0) {
                  <div class="flex flex-col items-center justify-center p-8 text-center text-text-secondary min-h-[120px]">
                    <span class="material-icons text-4xl mb-4 opacity-50">signal_wifi_off</span>
                    <p>No relays configured. Add a relay or reset to defaults.</p>
                  </div>
                }

                @for (relay of relayUrls(); track relay) {
                  <div class="flex items-center justify-between py-3 px-4 border-b border-border last:border-b-0 hover:bg-surface-hover transition-colors duration-150 ease-in-out" [@fadeInOut]>
                    <div class="flex items-center gap-3 min-w-0">
                      <span class="material-icons text-accent flex-shrink-0">wifi</span>
                      <span class="break-all font-mono text-sm text-text truncate">{{ relay }}</span>
                    </div>
                    <button class="bg-none border-none text-text-secondary w-8 h-8 rounded-full flex items-center justify-center cursor-pointer transition duration-200 ease-in-out flex-shrink-0 hover:bg-red-500/10 hover:text-warning" (click)="removeRelay(relay)" title="Remove relay">
                      <span class="material-icons text-lg">close</span> <!-- Adjusted size -->
                    </button>
                  </div>
                }
              </div>

              <div class="mb-3 w-full">
                <div class="flex rounded-lg overflow-hidden shadow-sm border border-border transition duration-300 ease-in-out w-full flex-nowrap relative focus-within:ring-2 focus-within:ring-accent focus-within:border-accent bg-surface-ground"> <!-- Added bg -->
                  <div class="flex-1 relative min-w-0">
                    <span class="material-icons absolute left-3 top-1/2 -translate-y-1/2 text-text-secondary pointer-events-none z-[1]">add_link</span>
                    <input
                      #newRelayInput
                      type="url"
                      placeholder="wss://relay.example.com"
                      class="w-full py-3 pl-10 pr-4 bg-transparent border-none focus:outline-none text-text"
                      [(ngModel)]="newRelayUrl"
                      (keyup.enter)="addRelay()"
                    />
                  </div>
                  <button
                    class="px-4 bg-accent text-white border-none flex items-center justify-center hover:bg-accent-light transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                    [disabled]="!newRelayUrl() || !isValidUrl(newRelayUrl())"
                    (click)="addRelay()"
                  >
                    <span class="material-icons">add</span>
                  </button>
                </div>
              </div>

              @if (newRelayUrl() && !isValidUrl(newRelayUrl())) {
                <div class="flex items-center gap-2 text-warning text-sm mb-4" [@fadeInOut]>
                  <span class="material-icons text-lg">error</span>
                  Must be a valid WebSocket URL (wss://)
                </div>
              }

              <div class="text-center mt-6"> <!-- Increased margin -->
                <button
                  class="flex items-center justify-center gap-2 w-full max-w-xs mx-auto py-3 px-6 rounded-lg border-none bg-accent text-white font-medium cursor-pointer transition duration-200 ease-out hover:enabled:bg-accent-light hover:enabled:-translate-y-0.5 hover:enabled:scale-105 hover:enabled:shadow-lg hover:enabled:shadow-accent/25 disabled:opacity-50 disabled:cursor-not-allowed"
                  [disabled]="relayUrls().length === 0"
                  (click)="saveAndReloadRelays()"
                >
                  <span class="material-icons">save</span>
                  Save & Reload Relays
                </button>

                @if (relaySaveMessage()) {
                  <div class="mt-4 text-success text-sm p-2 bg-green-500/10 rounded" [@fadeInOut]>
                    {{ relaySaveMessage() }}
                  </div>
                }
              </div>
            </div>
          </div>
        }

        <!-- Indexers Tab -->
        @if (activeTab() === 'indexers') {
          <div class="bg-surface-card rounded-xl p-5 sm:p-6 shadow-md">
            <h2 class="flex items-center gap-3 mt-0 mb-6 text-2xl font-semibold text-text">
              <span class="material-icons text-accent text-3xl">storage</span>
              Indexers
            </h2>

            <div class="py-5 border-t border-border"> <!-- Added top border -->
              <label class="block text-lg font-semibold mb-2 text-text">Manage Indexers</label>
              <p class="text-text-secondary mb-5 text-sm leading-normal">Configure indexer endpoints for project data retrieval on each network.</p>

              <div class="flex items-center justify-end mb-4">
                <button class="flex items-center gap-2 bg-none border-none text-sm text-accent cursor-pointer p-2 rounded transition duration-200 ease-in-out hover:bg-accent/10" (click)="resetToDefaultIndexers()">
                  <span class="material-icons text-lg">restart_alt</span>
                  Reset to defaults
                </button>
              </div>

              <!-- Mainnet Indexers -->
              <div class="mb-8 pb-6 border-b border-border last:border-b-0 last:mb-4">
                <h3 class="flex items-center gap-2 text-lg mt-2 mb-4 font-semibold text-text">
                  <span class="material-icons text-xl text-bitcoin-mainnet">currency_bitcoin</span>
                  Mainnet Indexers
                </h3>

                <div class="max-h-72 overflow-y-auto mb-6 border border-border rounded-lg bg-surface-ground">
                  @if (getMainnetIndexers().length === 0) {
                    <div class="flex flex-col items-center justify-center p-8 text-center text-text-secondary min-h-[100px]">
                      <span class="material-icons text-4xl mb-4 opacity-50">dns_disabled</span>
                      <p>No mainnet indexers configured. Add an indexer or reset to defaults.</p>
                    </div>
                  }

                  @for (indexer of getMainnetIndexers(); track indexer.url) {
                    <div class="flex flex-col py-3 px-4 border-b border-border last:border-b-0 hover:bg-surface-hover transition-colors duration-150 ease-in-out" [@fadeInOut]>
                      <div class="flex flex-col md:flex-row justify-between items-start md:items-center w-full gap-2">
                        <div class="flex items-center gap-3 flex-1 min-w-0">
                          <div class="relative flex items-center justify-center w-8 h-8 flex-shrink-0">
                            <span class="material-icons text-accent indexer-icon">dns</span>
                            @if (indexer.isPrimary) {
                              <span class="absolute -top-1 -right-1 bg-surface-card rounded-full w-5 h-5 flex items-center justify-center shadow" title="Primary Indexer">
                                <span class="material-icons text-sm text-yellow-500">star</span>
                              </span>
                            }
                          </div>
                          <span class="break-all font-mono text-sm text-text flex-1 min-w-0 pr-4 truncate">{{ indexer.url }}</span>
                        </div>
                        <div class="flex items-center gap-2 flex-shrink-0 w-full md:w-auto justify-end">
                          @if (indexerTestingUrl() === indexer.url && indexerTestResult() === null) {
                            <span class="text-sm text-text-secondary inline-flex items-center gap-2 px-2">
                              <div class="w-4 h-4 border-2 border-accent/20 border-t-accent rounded-full animate-spin"></div>
                              Testing...
                            </span>
                          } @else {
                            <button
                              class="bg-none border-none w-9 h-9 rounded-md flex items-center justify-center cursor-pointer transition duration-200 ease-in-out flex-shrink-0 text-text-secondary hover:bg-blue-500/10 hover:text-blue-600 disabled:opacity-50 disabled:cursor-not-allowed"
                              (click)="testIndexerConnection(indexer.url)"
                              title="Test connection"
                              [disabled]="indexerTestingUrl() !== null"
                            >
                              <span class="material-icons text-lg">network_check</span>
                            </button>
                          }

                          @if (!indexer.isPrimary) {
                            <button
                              class="bg-none border-none w-9 h-9 rounded-md flex items-center justify-center cursor-pointer transition duration-200 ease-in-out flex-shrink-0 text-text-secondary hover:bg-yellow-500/10 hover:text-yellow-600 disabled:opacity-50 disabled:cursor-not-allowed"
                              (click)="setPrimaryIndexer(indexer.url, true)"
                              title="Make primary"
                              [disabled]="indexerTestingUrl() !== null"
                            >
                              <span class="material-icons text-lg">star_outline</span>
                            </button>
                          }

                          @if (getMainnetIndexers().length > 1) {
                            <button
                              class="bg-none border-none w-9 h-9 rounded-md flex items-center justify-center cursor-pointer transition duration-200 ease-in-out flex-shrink-0 text-text-secondary hover:bg-red-500/10 hover:text-warning disabled:opacity-50 disabled:cursor-not-allowed"
                              (click)="removeIndexer(indexer.url, true)"
                              title="Remove indexer"
                              [disabled]="indexerTestingUrl() !== null || indexer.isPrimary"
                            >
                              <span class="material-icons text-lg">close</span>
                            </button>
                          }
                        </div>
                      </div>

                      @if (indexerTestingUrl() === indexer.url && indexerTestResult() !== null) {
                        <div class="mt-2 text-sm p-3 rounded-md bg-surface-card border-l-4"
                             [class.border-success]="indexerTestResult()"
                             [class.border-warning]="!indexerTestResult()"
                             [@fadeInOut]>
                          @if (indexerTestResult()) {
                            <span class="text-success flex items-center gap-2">
                              <span class="material-icons text-success">check_circle</span>
                              Connection successful
                            </span>
                          } @else {
                            <span class="text-warning flex items-center gap-2">
                              <span class="material-icons text-warning">error</span>
                              Connection failed
                            </span>
                          }
                        </div>
                      }
                    </div>
                  }
                </div>

                <div class="mb-4 w-full">
                  <div class="flex rounded-lg overflow-hidden shadow-sm border border-border transition duration-300 ease-in-out w-full flex-nowrap relative focus-within:ring-2 focus-within:ring-accent focus-within:border-accent bg-surface-ground"> <!-- Added bg -->
                     <div class="flex-1 relative min-w-0">
                       <span class="material-icons absolute left-3 top-1/2 -translate-y-1/2 text-text-secondary pointer-events-none z-[1]">dns</span>
                       <input
                         #newMainnetIndexerInput
                         type="url"
                         placeholder="https://indexer.example.com"
                         class="w-full py-3 pl-10 pr-4 bg-transparent border-none focus:outline-none text-text"
                         [(ngModel)]="newMainnetIndexerUrl"
                         (keyup.enter)="addIndexer(true)"
                       />
                     </div>
                     <button
                       class="px-4 bg-accent text-white border-none flex items-center justify-center hover:bg-accent-light transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                       [disabled]="!newMainnetIndexerUrl() || !isValidIndexerUrl(newMainnetIndexerUrl())"
                       (click)="addIndexer(true)"
                     >
                       <span class="material-icons">add</span>
                     </button>
                  </div>
                </div>
                <!-- Add validation message for Mainnet Indexer URL -->
                @if (newMainnetIndexerUrl() && !isValidIndexerUrl(newMainnetIndexerUrl())) {
                  <div class="flex items-center gap-2 text-warning text-sm mb-4" [@fadeInOut]>
                    <span class="material-icons text-lg">error</span>
                    Must be a valid HTTPS or HTTP URL (https:// or http://)
                  </div>
                }
              </div>

              <!-- Testnet Indexers -->
              <div class="mb-8 pb-6 border-b border-border last:border-b-0 last:mb-4">
                <h3 class="flex items-center gap-2 text-lg mt-2 mb-4 font-semibold text-text">
                  <span class="material-icons text-xl text-bitcoin-testnet">science</span>
                  Testnet Indexers
                </h3>

                <div class="max-h-72 overflow-y-auto mb-6 border border-border rounded-lg bg-surface-ground">
                  @if (getTestnetIndexers().length === 0) {
                    <div class="flex flex-col items-center justify-center p-8 text-center text-text-secondary min-h-[100px]">
                      <span class="material-icons text-4xl mb-4 opacity-50">dns_disabled</span>
                      <p>No testnet indexers configured. Add an indexer or reset to defaults.</p>
                    </div>
                  }

                  @for (indexer of getTestnetIndexers(); track indexer.url) {
                    <div class="flex flex-col py-3 px-4 border-b border-border last:border-b-0 hover:bg-surface-hover transition-colors duration-150 ease-in-out" [@fadeInOut]>
                      <div class="flex flex-col md:flex-row justify-between items-start md:items-center w-full gap-2">
                        <div class="flex items-center gap-3 flex-1 min-w-0">
                          <div class="relative flex items-center justify-center w-8 h-8 flex-shrink-0">
                            <span class="material-icons text-accent indexer-icon">dns</span>
                            @if (indexer.isPrimary) {
                              <span class="absolute -top-1 -right-1 bg-surface-card rounded-full w-5 h-5 flex items-center justify-center shadow" title="Primary Indexer">
                                <span class="material-icons text-sm text-yellow-500">star</span>
                              </span>
                            }
                          </div>
                          <span class="break-all font-mono text-sm text-text flex-1 min-w-0 pr-4 truncate">{{ indexer.url }}</span>
                        </div>
                        <div class="flex items-center gap-2 flex-shrink-0 w-full md:w-auto justify-end">
                           @if (indexerTestingUrl() === indexer.url && indexerTestResult() === null) {
                            <span class="text-sm text-text-secondary inline-flex items-center gap-2 px-2">
                              <div class="w-4 h-4 border-2 border-accent/20 border-t-accent rounded-full animate-spin"></div>
                              Testing...
                            </span>
                          } @else {
                            <button
                              class="bg-none border-none w-9 h-9 rounded-md flex items-center justify-center cursor-pointer transition duration-200 ease-in-out flex-shrink-0 text-text-secondary hover:bg-blue-500/10 hover:text-blue-600 disabled:opacity-50 disabled:cursor-not-allowed"
                              (click)="testIndexerConnection(indexer.url)"
                              title="Test connection"
                              [disabled]="indexerTestingUrl() !== null"
                            >
                              <span class="material-icons text-lg">network_check</span>
                            </button>
                          }

                          @if (!indexer.isPrimary) {
                            <button
                              class="bg-none border-none w-9 h-9 rounded-md flex items-center justify-center cursor-pointer transition duration-200 ease-in-out flex-shrink-0 text-text-secondary hover:bg-yellow-500/10 hover:text-yellow-600 disabled:opacity-50 disabled:cursor-not-allowed"
                              (click)="setPrimaryIndexer(indexer.url, false)"
                              title="Make primary"
                              [disabled]="indexerTestingUrl() !== null"
                            >
                              <span class="material-icons text-lg">star_outline</span>
                            </button>
                          }

                          @if (getTestnetIndexers().length > 1) {
                            <button
                              class="bg-none border-none w-9 h-9 rounded-md flex items-center justify-center cursor-pointer transition duration-200 ease-in-out flex-shrink-0 text-text-secondary hover:bg-red-500/10 hover:text-warning disabled:opacity-50 disabled:cursor-not-allowed"
                              (click)="removeIndexer(indexer.url, false)"
                              title="Remove indexer"
                              [disabled]="indexerTestingUrl() !== null || indexer.isPrimary"
                            >
                              <span class="material-icons text-lg">close</span>
                            </button>
                          }
                        </div>
                      </div>

                      @if (indexerTestingUrl() === indexer.url && indexerTestResult() !== null) {
                        <div class="mt-2 text-sm p-3 rounded-md bg-surface-card border-l-4"
                             [class.border-success]="indexerTestResult()"
                             [class.border-warning]="!indexerTestResult()"
                             [@fadeInOut]>
                          @if (indexerTestResult()) {
                            <span class="text-success flex items-center gap-2">
                              <span class="material-icons text-success">check_circle</span>
                              Connection successful
                            </span>
                          } @else {
                            <span class="text-warning flex items-center gap-2">
                              <span class="material-icons text-warning">error</span>
                              Connection failed
                            </span>
                          }
                        </div>
                      }
                    </div>
                  }
                </div>

                <div class="mb-4 w-full">
                  <div class="flex rounded-lg overflow-hidden shadow-sm border border-border transition duration-300 ease-in-out w-full flex-nowrap relative focus-within:ring-2 focus-within:ring-accent focus-within:border-accent bg-surface-ground"> <!-- Added bg -->
                     <div class="flex-1 relative min-w-0">
                       <span class="material-icons absolute left-3 top-1/2 -translate-y-1/2 text-text-secondary pointer-events-none z-[1]">dns</span>
                       <input
                         #newTestnetIndexerInput
                         type="url"
                         placeholder="https://testnet-indexer.example.com"
                         class="w-full py-3 pl-10 pr-4 bg-transparent border-none focus:outline-none text-text"
                         [(ngModel)]="newTestnetIndexerUrl"
                         (keyup.enter)="addIndexer(false)"
                       />
                     </div>
                     <button
                       class="px-4 bg-accent text-white border-none flex items-center justify-center hover:bg-accent-light transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                       [disabled]="!newTestnetIndexerUrl() || !isValidIndexerUrl(newTestnetIndexerUrl())"
                       (click)="addIndexer(false)"
                     >
                       <span class="material-icons">add</span>
                     </button>
                  </div>
                </div>
                <!-- Add validation message for Testnet Indexer URL -->
                @if (newTestnetIndexerUrl() && !isValidIndexerUrl(newTestnetIndexerUrl())) {
                  <div class="flex items-center gap-2 text-warning text-sm mb-4" [@fadeInOut]>
                    <span class="material-icons text-lg">error</span>
                    Must be a valid HTTPS or HTTP URL (https:// or http://)
                  </div>
                }
              </div>

              <div class="text-center mt-6"> <!-- Increased margin -->
                <button
                  class="flex items-center justify-center gap-2 w-full max-w-xs mx-auto py-3 px-6 rounded-lg border-none bg-accent text-white font-medium cursor-pointer transition duration-200 ease-out hover:enabled:bg-accent-light hover:enabled:-translate-y-0.5 hover:enabled:scale-105 hover:enabled:shadow-lg hover:enabled:shadow-accent/25 disabled:opacity-50 disabled:cursor-not-allowed"
                  (click)="saveAndApplyIndexers()"
                >
                  <span class="material-icons">save</span>
                  Save & Apply Indexers
                </button>

                @if (indexerSaveMessage()) {
                  <div class="mt-4 text-sm p-2 rounded"
                       [class.text-success]="!indexerSaveMessage().includes('exists')"
                       [class.bg-green-500]="!indexerSaveMessage().includes('exists')"
                       [class.text-warning]="indexerSaveMessage().includes('exists')"
                       [class.bg-yellow-500]="indexerSaveMessage().includes('exists')"
                       [@fadeInOut]>
                    {{ indexerSaveMessage() }}
                  </div>
                }
              </div>
            </div>
          </div>
        }

        <!-- About Tab -->
        @if (activeTab() === 'about') {
          <div class="bg-surface-card rounded-xl p-5 sm:p-6 shadow-md">
            <h2 class="flex items-center gap-3 mt-0 mb-6 text-2xl font-semibold text-text">
              <span class="material-icons text-accent text-3xl">info</span>
              About Angor Hub
            </h2>

            <div class="flex flex-col items-center text-center py-5 border-t border-border"> <!-- Added top border -->
              <div class="mb-6">
                <img src="/images/logo-text.svg" alt="Angor Logo" class="w-32 h-32 object-contain" />
              </div>

              <div class="mb-6">
                <p class="text-xl font-semibold text-text m-0 mb-1">Version {{ appVersion }}</p>
               </div>

              <div class="mb-8 max-w-2xl">
                <p class="leading-relaxed text-text-secondary">Angor Hub is an explorer for Bitcoin fundraising projects built on the Angor protocol. It provides a way to discover, track, and interact with Bitcoin funding opportunities powered by Nostr.</p>
              </div>

              <div class="w-full max-w-lg"> <!-- Constrained width -->
                <h3 class="text-lg mb-4 text-text relative inline-block font-semibold">Resources</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                  <a href="https://angor.io" target="_blank" rel="noopener" class="flex items-center justify-center gap-3 p-4 text-text bg-surface-ground rounded-lg transition duration-200 ease-in-out no-underline hover:-translate-y-0.5 hover:bg-accent/10 hover:shadow-md border border-border hover:border-accent/30">
                    <span class="material-icons text-accent">language</span> Website
                  </a>
                  <a href="https://docs.angor.io" target="_blank" rel="noopener" class="flex items-center justify-center gap-3 p-4 text-text bg-surface-ground rounded-lg transition duration-200 ease-in-out no-underline hover:-translate-y-0.5 hover:bg-accent/10 hover:shadow-md border border-border hover:border-accent/30">
                     <span class="material-icons text-accent">menu_book</span> Documentation
                  </a>
                  <a href="https://github.com/block-core/angor" target="_blank" rel="noopener" class="flex items-center justify-center gap-3 p-4 text-text bg-surface-ground rounded-lg transition duration-200 ease-in-out no-underline hover:-translate-y-0.5 hover:bg-accent/10 hover:shadow-md border border-border hover:border-accent/30">
                     <span class="material-icons text-accent">code</span> GitHub
                  </a>
                  <a href="https://blog.angor.io" target="_blank" rel="noopener" class="flex items-center justify-center gap-3 p-4 text-text bg-surface-ground rounded-lg transition duration-200 ease-in-out no-underline hover:-translate-y-0.5 hover:bg-accent/10 hover:shadow-md border border-border hover:border-accent/30">
                     <span class="material-icons text-accent">article</span> Blog
                  </a>
                </div>
              </div>
            </div>
          </div>
        }
      </div>
    </div>
</section>